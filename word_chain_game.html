<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨€è‘‰ã—ã‚Šã¨ã‚Šãƒ»é€£æƒ³ã‚²ãƒ¼ãƒ  - è„³ãƒˆãƒ¬ã‚²ãƒ¼ãƒ version2</title>
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        .game-frame {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .header {
            margin-bottom: 20px;
        }
        .title {
            color: #1a73e8;
            font-size: 1.8em;
            margin: 0 0 10px 0;
        }
        .mode-selector {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .mode-btn {
            background-color: #e8eaed;
            color: #333;
            border: 2px solid #dadce0;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        .mode-btn.active {
            background-color: #1a73e8;
            color: white;
            border-color: #1a73e8;
        }
        .mode-btn:hover {
            background-color: #1557b0;
            color: white;
            border-color: #1557b0;
        }
        .controls {
            margin: 15px 0;
        }
        .btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 0 5px;
        }
        .btn:hover {
            background-color: #1557b0;
        }
        .btn:disabled {
            background-color: #dadce0;
            cursor: not-allowed;
        }
        .content-area {
            min-height: 300px;
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .message {
            font-size: 1.1em;
            margin: 10px 0;
            color: #666;
        }
        .input-area {
            margin: 20px 0;
        }
        .word-input {
            font-size: 1.2em;
            padding: 10px;
            width: 200px;
            border: 2px solid #1a73e8;
            border-radius: 5px;
            margin-right: 10px;
        }
        .word-input:disabled {
            background-color: #f5f5f5;
            border-color: #dadce0;
        }
        .demo-controls {
            margin: 15px 0;
        }
        .demo-speed {
            margin: 10px 0;
        }
        .speed-slider {
            width: 200px;
            margin: 0 10px;
        }
        .word-chain {
            margin: 20px 0;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
        }
        .word-item {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background-color: #e3f2fd;
            border-radius: 15px;
            font-size: 0.9em;
        }
        .word-item.current {
            background-color: #1a73e8;
            color: white;
        }
        .footer {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .stat-item {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
        }
        .stat-label {
            font-size: 1em;
            color: #666;
        }
        .stat-value {
            font-size: 1.3em;
            color: #1a73e8;
            font-weight: bold;
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #1a73e8;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
        }
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .game-result {
            margin-top: 20px;
        }
        .correct-count,
        .total-count,
        .miss-count {
            margin-bottom: 10px;
        }
        .correct-label,
        .total-label,
        .miss-label {
            font-weight: bold;
        }
        .game-result button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
        }
        .game-result button:hover {
            background-color: #1557b0;
        }
        .result-summary {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        .result-stat {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result-stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 5px;
        }
        .result-stat-label {
            font-size: 0.9em;
            color: #666;
        }
        .word-chain-result {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .word-chain-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #1a73e8;
        }
        .result-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .result-actions button {
            margin: 0 5px;
        }
        .accuracy-high {
            color: #28a745;
        }
        .accuracy-medium {
            color: #ffc107;
        }
        .accuracy-low {
            color: #dc3545;
        }
        .demo-retry-options {
            text-align: center;
            padding: 20px;
        }
        .demo-retry-options h3 {
            color: #1a73e8;
            margin-bottom: 20px;
        }
        .retry-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .retry-buttons .btn {
            padding: 15px 20px;
            font-size: 1.1em;
        }
        .demo-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .demo-info p {
            margin: 5px 0;
            color: #666;
        }
        .auto-retry-countdown {
            text-align: center;
            padding: 40px 20px;
        }
        .auto-retry-countdown h3 {
            color: #1a73e8;
            margin-bottom: 20px;
        }
        .countdown-timer {
            font-size: 4em;
            font-weight: bold;
            color: #1a73e8;
            margin: 20px 0;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .speed-change-dialog {
            text-align: center;
            padding: 20px;
        }
        .speed-change-dialog h3 {
            color: #1a73e8;
            margin-bottom: 20px;
        }
        .speed-controls {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .speed-controls label {
            display: block;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .speed-buttons {
            margin-top: 20px;
        }
        .speed-buttons .btn {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-frame">
            <div class="header">
                <h1 class="title">è¨€è‘‰ã—ã‚Šã¨ã‚Šãƒ»é€£æƒ³ã‚²ãƒ¼ãƒ </h1>
                <p class="message">å‰ã®è¨€è‘‰ã®æœ€å¾Œã®æ–‡å­—ã‹ã‚‰å§‹ã¾ã‚‹è¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>

            <div class="mode-selector">
                <button class="mode-btn active" onclick="switchMode('normal')">é€šå¸¸ãƒ¢ãƒ¼ãƒ‰</button>
                <button class="mode-btn" onclick="switchMode('demo')">ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰</button>
            </div>

            <div class="controls">
                <button class="btn" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
                <button class="btn" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <div class="demo-controls" id="demoControls" style="display: none;">
                <div class="demo-speed">
                    <label>é€Ÿåº¦: <span id="speedValue">2</span>ç§’</label>
                    <input type="range" class="speed-slider" id="speedSlider" min="1" max="5" value="2">
                </div>
                <button class="btn" onclick="toggleDemo()" id="demoToggleBtn">ãƒ‡ãƒ¢é–‹å§‹</button>
            </div>

            <div class="content-area" id="gameArea">
                <div class="word-chain" id="wordChain"></div>
                <div class="input-area">
                    <input type="text" class="word-input" id="wordInput" placeholder="è¨€è‘‰ã‚’å…¥åŠ›">
                    <button class="btn" onclick="submitWord()" id="submitBtn">é€ä¿¡</button>
                </div>
                <p class="message" id="gameMessage">ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
            </div>

            <div class="footer">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">æ®‹ã‚Šå•é¡Œæ•°</div>
                        <div class="stat-value" id="questionCount">10</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ã‚¹ã‚³ã‚¢</div>
                        <div class="stat-value" id="score">0</div>
                    </div>
                </div>
            </div>
        </div>
        <a href="index.html" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

    <div class="modal" id="main-content">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="game-result">
                <h2>ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
                
                <div class="result-summary">
                    <div class="result-stats">
                        <div class="result-stat">
                            <div class="result-stat-value" id="finalScore">0</div>
                            <div class="result-stat-label">æœ€çµ‚ã‚¹ã‚³ã‚¢</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="accuracyRate">0%</div>
                            <div class="result-stat-label">æ­£è§£ç‡</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="totalTime">0ç§’</div>
                            <div class="result-stat-label">ç·æ™‚é–“</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="maxCombo">0</div>
                            <div class="result-stat-label">æœ€å¤§ã‚³ãƒ³ãƒœ</div>
                        </div>
                    </div>
                    
                    <div class="word-chain-result">
                        <div class="word-chain-title">å®Œæˆã—ãŸè¨€è‘‰ãƒã‚§ãƒ¼ãƒ³</div>
                        <div id="finalWordChain"></div>
                </div>
                </div>
                
                <div class="result-actions">
                    <button class="btn" onclick="resetGame()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
                    <button class="btn" onclick="closeResult()" id="closeResultBtn">é–‰ã˜ã‚‹</button>
                </div>
            </div>
        </div>
    </div>

    <script src="game_result.js"></script>
    <script>
        let isGameActive = false;
        let isDemoMode = false;
        let isDemoRunning = false;
        let score = 0;
        let startTime = 0;
        let comboCount = 0;
        let maxComboCount = 0;
        let correctCount = 0;
        let incorrectCount = 0;
        let lastWord = '';
        let questionCount = 10;
        let demoInterval = null;
        let wordChain = [];
        let gameEndTime = 0;

        // ãƒ‡ãƒ¢ç”¨ã®è¨€è‘‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const demoWords = {
            'ã‚': ['ã‚ã‚', 'ã‚ã‹', 'ã‚ãŠ', 'ã‚ãŸã¾', 'ã‚ã—', 'ã‚ã‚', 'ã‚ã•', 'ã‚ã‚†', 'ã‚ã‹ã­', 'ã‚ã˜ã•ã„'],
            'ã„': ['ã„ã¬', 'ã„ã¡ã”', 'ã„ã™', 'ã„ãˆ', 'ã„ã‘', 'ã„ã—', 'ã„ã¨', 'ã„ã¬', 'ã„ã¡', 'ã„ã‚Š'],
            'ã†': ['ã†ã¿', 'ã†ã¾', 'ã†ã—', 'ã†ãŸ', 'ã†ã§', 'ã†ãªã', 'ã†ã•ã', 'ã†ã¾', 'ã†ã¿', 'ã†ãŸ'],
            'ãˆ': ['ãˆã‚“ã´ã¤', 'ãˆã', 'ãˆã ', 'ãˆã»ã‚“', 'ãˆã„ã”', 'ãˆã', 'ãˆã ', 'ãˆã»ã‚“', 'ãˆã„ã”', 'ãˆã‚“ã´ã¤'],
            'ãŠ': ['ãŠã‹', 'ãŠã«', 'ãŠã¯ãª', 'ãŠã¨', 'ãŠã‹ã­', 'ãŠã«', 'ãŠã¯ãª', 'ãŠã¨', 'ãŠã‹ã­', 'ãŠã‹'],
            'ã‹': ['ã‹ã¿', 'ã‹ã•', 'ã‹ã°ã‚“', 'ã‹ã¿', 'ã‹ã•', 'ã‹ã°ã‚“', 'ã‹ã¿', 'ã‹ã•', 'ã‹ã°ã‚“', 'ã‹ã¿'],
            'ã': ['ãã', 'ãã¤ã­', 'ãã‚‚ã¡', 'ãã', 'ãã¤ã­', 'ãã‚‚ã¡', 'ãã', 'ãã¤ã­', 'ãã‚‚ã¡', 'ãã'],
            'ã': ['ãã‚‚', 'ãã¤', 'ãã¾', 'ãã‚‚', 'ãã¤', 'ãã¾', 'ãã‚‚', 'ãã¤', 'ãã¾', 'ãã‚‚'],
            'ã‘': ['ã‘ã—ã”ã‚€', 'ã‘ã‚“', 'ã‘ã‚“ã‹', 'ã‘ã—ã”ã‚€', 'ã‘ã‚“', 'ã‘ã‚“ã‹', 'ã‘ã—ã”ã‚€', 'ã‘ã‚“', 'ã‘ã‚“ã‹', 'ã‘ã—ã”ã‚€'],
            'ã“': ['ã“ã¨ã‚Š', 'ã“ã¾', 'ã“ãŠã‚Š', 'ã“ã¨ã‚Š', 'ã“ã¾', 'ã“ãŠã‚Š', 'ã“ã¨ã‚Š', 'ã“ã¾', 'ã“ãŠã‚Š', 'ã“ã¨ã‚Š'],
            'ã•': ['ã•ãã‚‰', 'ã•ã‹ãª', 'ã•ã¨ã†', 'ã•ãã‚‰', 'ã•ã‹ãª', 'ã•ã¨ã†', 'ã•ãã‚‰', 'ã•ã‹ãª', 'ã•ã¨ã†', 'ã•ãã‚‰'],
            'ã—': ['ã—ã¾', 'ã—ã‚“ã¶ã‚“', 'ã—ã‚ƒã—ã‚“', 'ã—ã¾', 'ã—ã‚“ã¶ã‚“', 'ã—ã‚ƒã—ã‚“', 'ã—ã¾', 'ã—ã‚“ã¶ã‚“', 'ã—ã‚ƒã—ã‚“', 'ã—ã¾'],
            'ã™': ['ã™ã„ã‹', 'ã™ãšã‚', 'ã™ã¿', 'ã™ã„ã‹', 'ã™ãšã‚', 'ã™ã¿', 'ã™ã„ã‹', 'ã™ãšã‚', 'ã™ã¿', 'ã™ã„ã‹'],
            'ã›': ['ã›ã‚“ã›ã„', 'ã›ã‹ã„', 'ã›ã‚“ãŸã', 'ã›ã‚“ã›ã„', 'ã›ã‹ã„', 'ã›ã‚“ãŸã', 'ã›ã‚“ã›ã„', 'ã›ã‹ã„', 'ã›ã‚“ãŸã', 'ã›ã‚“ã›ã„'],
            'ã': ['ãã‚‰', 'ãã°', 'ããµã¨', 'ãã‚‰', 'ãã°', 'ããµã¨', 'ãã‚‰', 'ãã°', 'ããµã¨', 'ãã‚‰'],
            'ãŸ': ['ãŸã¾ã”', 'ãŸã‹ã‚‰', 'ãŸã¹ã‚‚ã®', 'ãŸã¾ã”', 'ãŸã‹ã‚‰', 'ãŸã¹ã‚‚ã®', 'ãŸã¾ã”', 'ãŸã‹ã‚‰', 'ãŸã¹ã‚‚ã®', 'ãŸã¾ã”'],
            'ã¡': ['ã¡ãš', 'ã¡ã‚‡ã†ã¡ã‚‡', 'ã¡ã‹ã¦ã¤', 'ã¡ãš', 'ã¡ã‚‡ã†ã¡ã‚‡', 'ã¡ã‹ã¦ã¤', 'ã¡ãš', 'ã¡ã‚‡ã†ã¡ã‚‡', 'ã¡ã‹ã¦ã¤', 'ã¡ãš'],
            'ã¤': ['ã¤ããˆ', 'ã¤ã', 'ã¤ã‚Š', 'ã¤ããˆ', 'ã¤ã', 'ã¤ã‚Š', 'ã¤ããˆ', 'ã¤ã', 'ã¤ã‚Š', 'ã¤ããˆ'],
            'ã¦': ['ã¦ãŒã¿', 'ã¦ã‚“ã', 'ã¦ã‚“ã·ã‚‰', 'ã¦ãŒã¿', 'ã¦ã‚“ã', 'ã¦ã‚“ã·ã‚‰', 'ã¦ãŒã¿', 'ã¦ã‚“ã', 'ã¦ã‚“ã·ã‚‰', 'ã¦ãŒã¿'],
            'ã¨': ['ã¨ã‘ã„', 'ã¨ã‚Š', 'ã¨ã‘ã„', 'ã¨ã‚Š', 'ã¨ã‘ã„', 'ã¨ã‚Š', 'ã¨ã‘ã„', 'ã¨ã‚Š', 'ã¨ã‘ã„', 'ã¨ã‚Š'],
            'ãª': ['ãªã¤', 'ãªã¾ãˆ', 'ãªã‹', 'ãªã¤', 'ãªã¾ãˆ', 'ãªã‹', 'ãªã¤', 'ãªã¾ãˆ', 'ãªã‹', 'ãªã¤'],
            'ã«': ['ã«ã»ã‚“', 'ã«ã‚', 'ã«ã»ã‚“', 'ã«ã‚', 'ã«ã»ã‚“', 'ã«ã‚', 'ã«ã»ã‚“', 'ã«ã‚', 'ã«ã»ã‚“', 'ã«ã‚'],
            'ã¬': ['ã¬ã„ãã‚‹ã¿', 'ã¬ã‚Šãˆ', 'ã¬ã„ãã‚‹ã¿', 'ã¬ã‚Šãˆ', 'ã¬ã„ãã‚‹ã¿', 'ã¬ã‚Šãˆ', 'ã¬ã„ãã‚‹ã¿', 'ã¬ã‚Šãˆ', 'ã¬ã„ãã‚‹ã¿', 'ã¬ã‚Šãˆ'],
            'ã­': ['ã­ã“', 'ã­ãšã¿', 'ã­ã“', 'ã­ãšã¿', 'ã­ã“', 'ã­ãšã¿', 'ã­ã“', 'ã­ãšã¿', 'ã­ã“', 'ã­ãšã¿'],
            'ã®': ['ã®ã‚Š', 'ã®ã†', 'ã®ã‚Š', 'ã®ã†', 'ã®ã‚Š', 'ã®ã†', 'ã®ã‚Š', 'ã®ã†', 'ã®ã‚Š', 'ã®ã†'],
            'ã¯': ['ã¯ãª', 'ã¯ã—', 'ã¯ãª', 'ã¯ã—', 'ã¯ãª', 'ã¯ã—', 'ã¯ãª', 'ã¯ã—', 'ã¯ãª', 'ã¯ã—'],
            'ã²': ['ã²ã“ã†ã', 'ã²ã¾ã‚ã‚Š', 'ã²ã“ã†ã', 'ã²ã¾ã‚ã‚Š', 'ã²ã“ã†ã', 'ã²ã¾ã‚ã‚Š', 'ã²ã“ã†ã', 'ã²ã¾ã‚ã‚Š', 'ã²ã“ã†ã', 'ã²ã¾ã‚ã‚Š'],
            'ãµ': ['ãµã­', 'ãµã', 'ãµã­', 'ãµã', 'ãµã­', 'ãµã', 'ãµã­', 'ãµã', 'ãµã­', 'ãµã'],
            'ã¸': ['ã¸ã‚„', 'ã¸ã„ã‚', 'ã¸ã‚„', 'ã¸ã„ã‚', 'ã¸ã‚„', 'ã¸ã„ã‚', 'ã¸ã‚„', 'ã¸ã„ã‚', 'ã¸ã‚„', 'ã¸ã„ã‚'],
            'ã»': ['ã»ã—', 'ã»ã‚“', 'ã»ã—', 'ã»ã‚“', 'ã»ã—', 'ã»ã‚“', 'ã»ã—', 'ã»ã‚“', 'ã»ã—', 'ã»ã‚“'],
            'ã¾': ['ã¾ãã‚‰', 'ã¾ã¤ã‚Š', 'ã¾ãã‚‰', 'ã¾ã¤ã‚Š', 'ã¾ãã‚‰', 'ã¾ã¤ã‚Š', 'ã¾ãã‚‰', 'ã¾ã¤ã‚Š', 'ã¾ãã‚‰', 'ã¾ã¤ã‚Š'],
            'ã¿': ['ã¿ãš', 'ã¿ã‹ã‚“', 'ã¿ãš', 'ã¿ã‹ã‚“', 'ã¿ãš', 'ã¿ã‹ã‚“', 'ã¿ãš', 'ã¿ã‹ã‚“', 'ã¿ãš', 'ã¿ã‹ã‚“'],
            'ã‚€': ['ã‚€ã—', 'ã‚€ã‚‰', 'ã‚€ã—', 'ã‚€ã‚‰', 'ã‚€ã—', 'ã‚€ã‚‰', 'ã‚€ã—', 'ã‚€ã‚‰', 'ã‚€ã—', 'ã‚€ã‚‰'],
            'ã‚': ['ã‚ãŒã­', 'ã‚ã ã‹', 'ã‚ãŒã­', 'ã‚ã ã‹', 'ã‚ãŒã­', 'ã‚ã ã‹', 'ã‚ãŒã­', 'ã‚ã ã‹', 'ã‚ãŒã­', 'ã‚ã ã‹'],
            'ã‚‚': ['ã‚‚ã‚‚', 'ã‚‚ã‚Š', 'ã‚‚ã‚‚', 'ã‚‚ã‚Š', 'ã‚‚ã‚‚', 'ã‚‚ã‚Š', 'ã‚‚ã‚‚', 'ã‚‚ã‚Š', 'ã‚‚ã‚‚', 'ã‚‚ã‚Š'],
            'ã‚„': ['ã‚„ã•ã„', 'ã‚„ã¾', 'ã‚„ã•ã„', 'ã‚„ã¾', 'ã‚„ã•ã„', 'ã‚„ã¾', 'ã‚„ã•ã„', 'ã‚„ã¾', 'ã‚„ã•ã„', 'ã‚„ã¾'],
            'ã‚†': ['ã‚†ã', 'ã‚†ã‚', 'ã‚†ã', 'ã‚†ã‚', 'ã‚†ã', 'ã‚†ã‚', 'ã‚†ã', 'ã‚†ã‚', 'ã‚†ã', 'ã‚†ã‚'],
            'ã‚ˆ': ['ã‚ˆã‚‹', 'ã‚ˆã¿ã‚‚ã®', 'ã‚ˆã‚‹', 'ã‚ˆã¿ã‚‚ã®', 'ã‚ˆã‚‹', 'ã‚ˆã¿ã‚‚ã®', 'ã‚ˆã‚‹', 'ã‚ˆã¿ã‚‚ã®', 'ã‚ˆã‚‹', 'ã‚ˆã¿ã‚‚ã®'],
            'ã‚‰': ['ã‚‰ãã ', 'ã‚‰ã‚“', 'ã‚‰ãã ', 'ã‚‰ã‚“', 'ã‚‰ãã ', 'ã‚‰ã‚“', 'ã‚‰ãã ', 'ã‚‰ã‚“', 'ã‚‰ãã ', 'ã‚‰ã‚“'],
            'ã‚Š': ['ã‚Šã‚“ã”', 'ã‚Šã™', 'ã‚Šã‚“ã”', 'ã‚Šã™', 'ã‚Šã‚“ã”', 'ã‚Šã™', 'ã‚Šã‚“ã”', 'ã‚Šã™', 'ã‚Šã‚“ã”', 'ã‚Šã™'],
            'ã‚‹': ['ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“', 'ã‚‹ã™ã°ã‚“'],
            'ã‚Œ': ['ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“', 'ã‚Œã„ãã†ã“'],
            'ã‚': ['ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã', 'ã‚ã'],
            'ã‚': ['ã‚ã«', 'ã‚ã‹ã‚', 'ã‚ã«', 'ã‚ã‹ã‚', 'ã‚ã«', 'ã‚ã‹ã‚', 'ã‚ã«', 'ã‚ã‹ã‚', 'ã‚ã«', 'ã‚ã‹ã‚'],
            'ã‚’': ['ã‚’', 'ã‚’', 'ã‚’', 'ã‚’', 'ã‚’', 'ã‚’', 'ã‚’', 'ã‚’', 'ã‚’', 'ã‚’'],
            'ã‚“': ['ã‚“', 'ã‚“', 'ã‚“', 'ã‚“', 'ã‚“', 'ã‚“', 'ã‚“', 'ã‚“', 'ã‚“', 'ã‚“'],
            'ã”': ['ã”ã‚Šã‚‰', 'ã”ã¾', 'ã”ã¯ã‚“', 'ã”ã¿', 'ã”ã†ã‹ã'],
        };

        // ã‚²ãƒ¼ãƒ è¨­å®šã‚’å–å¾—
        const gameSettings = getGameSettings('wordchain');
        const difficultySettings = getDifficultySettings('wordchain');

        function switchMode(mode) {
            isDemoMode = (mode === 'demo');
            
            // ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ãƒ‡ãƒ¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¡¨ç¤º/éè¡¨ç¤º
            document.getElementById('demoControls').style.display = isDemoMode ? 'block' : 'none';
            
            // å…¥åŠ›ã‚¨ãƒªã‚¢ã®æœ‰åŠ¹/ç„¡åŠ¹
            document.getElementById('wordInput').disabled = isDemoMode;
            document.getElementById('submitBtn').disabled = isDemoMode;
            
            // ãƒ‡ãƒ¢ãŒå®Ÿè¡Œä¸­ã®å ´åˆã¯åœæ­¢
            if (isDemoRunning) {
                stopDemo();
            }
            
            resetGame();
        }

        function startGame() {
            isGameActive = true;
            score = 0;
            correctCount = 0;
            incorrectCount = 0;
            comboCount = 0;
            maxComboCount = 0;
            startTime = Date.now();
            gameEndTime = 0;
            lastWord = 'ã‚Šã‚“ã”';
            wordChain = [lastWord];
            
            // é›£æ˜“åº¦è¨­å®šã«åŸºã¥ã„ã¦å•é¡Œæ•°ã‚’è¨­å®š
            questionCount = difficultySettings.totalQuestions;
            
            updateStats();
            updateWordChain();
            
            if (isDemoMode) {
                document.getElementById('gameMessage').textContent = 'ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰: è‡ªå‹•ã§è¨€è‘‰ã‚’ç”Ÿæˆã—ã¾ã™';
                startDemo();
            } else {
            document.getElementById('gameMessage').textContent = `æœ€åˆã®è¨€è‘‰: ${lastWord}`;
            document.getElementById('wordInput').value = '';
            document.getElementById('wordInput').focus();
            }
        }

        function resetGame() {
            isGameActive = false;
            score = 0;
            correctCount = 0;
            incorrectCount = 0;
            comboCount = 0;
            maxComboCount = 0;
            startTime = 0;
            gameEndTime = 0;
            questionCount = 10;
            lastWord = '';
            wordChain = [];
            
            if (isDemoRunning) {
                stopDemo();
            }
            
            updateStats();
            updateWordChain();
            
            // ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ã‚’å…ƒã®çŠ¶æ…‹ã«å¾©å…ƒ
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="word-chain" id="wordChain"></div>
                <div class="input-area">
                    <input type="text" class="word-input" id="wordInput" placeholder="è¨€è‘‰ã‚’å…¥åŠ›">
                    <button class="btn" onclick="submitWord()" id="submitBtn">é€ä¿¡</button>
                </div>
                <p class="message" id="gameMessage">ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
            `;
            
            // å…¥åŠ›ã‚¨ãƒªã‚¢ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’è¨­å®š
            if (isDemoMode) {
                document.getElementById('wordInput').disabled = true;
                document.getElementById('submitBtn').disabled = true;
            } else {
                document.getElementById('wordInput').disabled = false;
                document.getElementById('submitBtn').disabled = false;
            }
            
            // Enterã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†è¨­å®š
            const wordInput = document.getElementById('wordInput');
            if (wordInput) {
                wordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitWord();
                    }
                });
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.getElementById('main-content').style.display = 'none';
        }

        function submitWord() {
            if (!isGameActive || isDemoMode) return;
            
            const input = document.getElementById('wordInput').value.trim();
            if (!input) return;
            
            const timeUsed = (Date.now() - startTime) / 1000;
            
            if (isValidWord(input, lastWord)) {
                correctCount++;
                comboCount++;
                maxComboCount = Math.max(maxComboCount, comboCount);
                document.getElementById('gameMessage').textContent = 'æ­£è§£ï¼';
                score = calculateScore(correctCount, questionCount, timeUsed, comboCount);
                lastWord = input;
                wordChain.push(input);
            } else {
                incorrectCount++;
                comboCount = 0;
                document.getElementById('gameMessage').textContent = 'ä¸æ­£è§£...';
            }
            
            questionCount--;
            updateStats();
            updateWordChain();
            
            if (questionCount <= 0) {
                isGameActive = false;
                gameEndTime = Date.now();
                showDetailedResult();
            } else {
                document.getElementById('wordInput').value = '';
                document.getElementById('wordInput').focus();
            }
        }

        function startDemo() {
            if (!isGameActive || !isDemoMode) return;
            
            isDemoRunning = true;
            document.getElementById('demoToggleBtn').textContent = 'ãƒ‡ãƒ¢åœæ­¢';
            
            const speed = document.getElementById('speedSlider').value * 1000;
            demoInterval = setInterval(() => {
                if (!isGameActive || questionCount <= 0) {
                    stopDemo();
                    return;
                }
                
                generateDemoWord();
            }, speed);
        }

        function stopDemo() {
            isDemoRunning = false;
            document.getElementById('demoToggleBtn').textContent = 'ãƒ‡ãƒ¢é–‹å§‹';
            if (demoInterval) {
                clearInterval(demoInterval);
                demoInterval = null;
            }
        }

        function toggleDemo() {
            if (isDemoRunning) {
                stopDemo();
            } else {
                startDemo();
            }
        }

        function generateDemoWord() {
            if (!isGameActive || questionCount <= 0) return;
            
            const lastChar = lastWord.slice(-1);
            const availableWords = demoWords[lastChar] || [];
            
            if (availableWords.length > 0) {
                const randomWord = availableWords[Math.floor(Math.random() * availableWords.length)];
                const timeUsed = (Date.now() - startTime) / 1000;
                
                correctCount++;
                comboCount++;
                maxComboCount = Math.max(maxComboCount, comboCount);
                score = calculateScore(correctCount, questionCount, timeUsed, comboCount);
                lastWord = randomWord;
                wordChain.push(randomWord);
                
                questionCount--;
                updateStats();
                updateWordChain();
                
                if (questionCount <= 0) {
                    isGameActive = false;
                    gameEndTime = Date.now();
                    stopDemo();
                    showDetailedResult();
                }
            }
        }

        function updateStats() {
            document.getElementById('questionCount').textContent = questionCount;
            document.getElementById('score').textContent = score;
        }

        function updateWordChain() {
            const wordChainElement = document.getElementById('wordChain');
            wordChainElement.innerHTML = '';
            
            wordChain.forEach((word, index) => {
                const wordElement = document.createElement('span');
                wordElement.className = 'word-item';
                if (index === wordChain.length - 1) {
                    wordElement.classList.add('current');
                }
                wordElement.textContent = word;
                wordChainElement.appendChild(wordElement);
            });
        }

        function isValidWord(input, lastWord) {
            if (!input || !lastWord) return false;
            
            const lastChar = lastWord.slice(-1);
            const firstChar = input.charAt(0);
            
            return lastChar === firstChar && input.length >= 2;
        }

        // é€Ÿåº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('speedSlider').addEventListener('input', function() {
            document.getElementById('speedValue').textContent = this.value;
            if (isDemoRunning) {
                stopDemo();
                startDemo();
        }
        });

        // Enterã‚­ãƒ¼ã§é€ä¿¡
        document.getElementById('wordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitWord();
            }
        });

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
        const closeButton = document.querySelector('.close');
        if (closeButton) {
            closeButton.addEventListener('click', function() {
                closeResult();
            });
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('main-content');
            if (event.target === modal) {
                closeResult();
            }
        });

        function showDetailedResult() {
            const totalTime = gameEndTime > 0 ? Math.round((gameEndTime - startTime) / 1000) : 0;
            const totalQuestions = difficultySettings.totalQuestions;
            const accuracyRate = totalQuestions > 0 ? Math.round((correctCount / totalQuestions) * 100) : 0;
            
            // çµæœã‚’è¡¨ç¤º
            document.getElementById('finalScore').textContent = score;
            document.getElementById('accuracyRate').textContent = accuracyRate + '%';
            document.getElementById('totalTime').textContent = totalTime + 'ç§’';
            document.getElementById('maxCombo').textContent = maxComboCount;
            
            // æ­£è§£ç‡ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´
            const accuracyElement = document.getElementById('accuracyRate');
            accuracyElement.className = 'result-stat-value';
            if (accuracyRate >= 80) {
                accuracyElement.classList.add('accuracy-high');
            } else if (accuracyRate >= 60) {
                accuracyElement.classList.add('accuracy-medium');
            } else {
                accuracyElement.classList.add('accuracy-low');
            }
            
            // å®Œæˆã—ãŸè¨€è‘‰ãƒã‚§ãƒ¼ãƒ³ã‚’è¡¨ç¤º
            const finalWordChainElement = document.getElementById('finalWordChain');
            finalWordChainElement.innerHTML = '';
            wordChain.forEach((word, index) => {
                const wordElement = document.createElement('span');
                wordElement.className = 'word-item';
                wordElement.textContent = word;
                finalWordChainElement.appendChild(wordElement);
                
                // æœ€å¾Œã®è¨€è‘‰ä»¥å¤–ã«çŸ¢å°ã‚’è¿½åŠ 
                if (index < wordChain.length - 1) {
                    const arrow = document.createElement('span');
                    arrow.textContent = ' â†’ ';
                    arrow.style.color = '#666';
                    arrow.style.margin = '0 5px';
                    finalWordChainElement.appendChild(arrow);
                }
            });
            
            // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ã€Œé–‰ã˜ã‚‹ã€ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´
            if (isDemoMode) {
                document.getElementById('closeResultBtn').textContent = 'çµæœã‚’é–‰ã˜ã‚‹';
            } else {
                document.getElementById('closeResultBtn').textContent = 'é–‰ã˜ã‚‹';
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('main-content').style.display = 'block';
        }

        function closeResult() {
                document.getElementById('main-content').style.display = 'none';
            // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰æ™‚ã‚‚resetGame()ã¯å‘¼ã°ãšã€ç”»é¢ã¯ãã®ã¾ã¾ç¶­æŒ
        }

        function showDemoRetryOptions() {
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="demo-retry-options">
                    <h3>ğŸ® ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ - æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                    <div class="retry-buttons">
                        <button class="btn" onclick="autoRetryDemo()">ğŸ”„ è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤</button>
                        <button class="btn" onclick="manualRetryDemo()">âœï¸ æ‰‹å‹•ãƒªãƒˆãƒ©ã‚¤</button>
                        <button class="btn" onclick="changeDemoSpeed()">âš™ï¸ é€Ÿåº¦å¤‰æ›´</button>
                        <button class="btn" onclick="backToMenu()">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
                    </div>
                    <div class="demo-info">
                        <p>ğŸ“Š å‰å›ã®çµæœ: ã‚¹ã‚³ã‚¢ ${score}ç‚¹ / æ­£è§£ç‡ ${Math.round((correctCount / difficultySettings.totalQuestions) * 100)}%</p>
                        <p>â±ï¸ ãƒ—ãƒ¬ã‚¤æ™‚é–“: ${Math.round((gameEndTime - startTime) / 1000)}ç§’</p>
                    </div>
                </div>
            `;
        }

        function autoRetryDemo() {
            // 3ç§’å¾Œã«è‡ªå‹•ã§ãƒªãƒˆãƒ©ã‚¤
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="auto-retry-countdown">
                    <h3>ğŸ”„ è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤æº–å‚™ä¸­...</h3>
                    <div class="countdown-timer" id="countdownTimer">3</div>
                    <p>æ–°ã—ã„ã‚²ãƒ¼ãƒ ãŒè‡ªå‹•ã§é–‹å§‹ã•ã‚Œã¾ã™</p>
                    <button class="btn" onclick="cancelAutoRetry()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            `;
            
            let countdown = 3;
            const countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('countdownTimer').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    startGame();
                }
            }, 1000);
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç”¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ä¿å­˜
            window.autoRetryInterval = countdownInterval;
        }

        function cancelAutoRetry() {
            if (window.autoRetryInterval) {
                clearInterval(window.autoRetryInterval);
                window.autoRetryInterval = null;
            }
            showDemoRetryOptions();
        }

        function manualRetryDemo() {
            // æ‰‹å‹•ã§ãƒªãƒˆãƒ©ã‚¤ï¼ˆé€šå¸¸ã®ã‚²ãƒ¼ãƒ é–‹å§‹ï¼‰
            resetGame();
            startGame();
        }

        function changeDemoSpeed() {
            // é€Ÿåº¦å¤‰æ›´ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="speed-change-dialog">
                    <h3>âš™ï¸ ãƒ‡ãƒ¢é€Ÿåº¦å¤‰æ›´</h3>
                    <div class="speed-controls">
                        <label>ç¾åœ¨ã®é€Ÿåº¦: <span id="currentSpeed">${document.getElementById('speedSlider').value}</span>ç§’</label>
                        <input type="range" class="speed-slider" id="newSpeedSlider" min="1" max="5" value="${document.getElementById('speedSlider').value}">
                        <div class="speed-buttons">
                            <button class="btn" onclick="applySpeedChange()">é©ç”¨</button>
                            <button class="btn" onclick="showDemoRetryOptions()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </div>
                </div>
            `;
            
            // æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('newSpeedSlider').addEventListener('input', function() {
                document.getElementById('currentSpeed').textContent = this.value;
            });
        }

        function applySpeedChange() {
            const newSpeed = document.getElementById('newSpeedSlider').value;
            document.getElementById('speedSlider').value = newSpeed;
            document.getElementById('speedValue').textContent = newSpeed;
            showDemoRetryOptions();
        }

        function backToMenu() {
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ï¼ˆãƒªã‚»ãƒƒãƒˆã—ã¦åˆæœŸçŠ¶æ…‹ã«ï¼‰
            resetGame();
            document.getElementById('gameMessage').textContent = 'ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„';
        }
    </script>
</body>
</html> 